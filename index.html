<!DOCTYPE html>
<html>
    <head>
        <link rel='stylesheet' href="./css/style.css" type="text/css"/>
        <link rel="stylesheet" href="./css/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
        <title>jsDraw tool</title>
        <style>
            label, input { display:block; }
            input.text { margin-bottom:12px; width:95%; padding: .4em; }
            fieldset { padding:0; border:0; margin-top:25px; }
            h1 { font-size: 1.2em; margin: .6em 0; }
            .ui-dialog .ui-state-error { padding: .3em; }
            .validateTips { border: 1px solid transparent; padding: 0.3em; }
        </style>
    </head>
    <body>        
        <div id="field">
            <canvas id="drawCanvas" width="1" height="1" style="border:1px solid #000000;"></canvas>
            <div id="buttons">
                    <button id="clear">Clear canvas</button>
            </div>
            <div id="colorButtons">
                    <button id="purple_color">Purple</button>
                    <button id="green_color">Green</button>
                    <button id="yellow_color">Yellow</button>
                    <button id="brown_color">Brown</button>
            </div>
        </div>

        <div id="dialog-form" title="Set parameters of canvas">
            <p class="validateTips">All form fields are required.</p>
            
            <form>
                <fieldset>
                <label for="width">width</label>
                <input type="number" name="width" id="width" value="600" class="text ui-widget-content ui-corner-all">
                <label for="height">height</label>
                <input type="number" name="height" id="height" value="600" class="text ui-widget-content ui-corner-all">
            
                <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
                </fieldset>
            </form>
        </div>

        <script type="text/javascript" src="./js/jsdraw.js"></script>
        <script type="text/javascript">
            $( function() {
                var dialog, form,wval,hval,
            
                width = $( "#width" ),
                height = $( "#height" ),
                allFields = $( [] ).add( width ).add( height ),
                tips = $( ".validateTips" );
            
                function updateTips( t ) {
                    tips
                        .text( t )
                        .addClass( "ui-state-highlight" );
                    setTimeout(function() {
                        tips.removeClass( "ui-state-highlight", 1500 );
                    }, 500 );
                }
            
                function checkLength( o, n, min, max ) {
                    if ( o.val().length > max || o.val().length < min ) {
                        o.addClass( "ui-state-error" );
                        updateTips( "Length of " + n + " must be between " +
                        min + " and " + max + "." );
                        return false;
                    } else {
                        return true;
                    }
                }
            
                function checkRegexp( o, regexp, n ) {
                    if ( !( regexp.test( o.val() ) ) ) {
                        o.addClass( "ui-state-error" );
                        updateTips( n );
                        return false;
                    } else {
                        return true;
                    }
                }
            
                function checkAndSet() {
                    var valid = true;
                    allFields.removeClass( "ui-state-error" );
                
                    valid = valid && checkLength( width, "width", 2, 4 );
                    valid = valid && checkLength( height, "height", 2, 4 );
                
                    valid = valid && checkRegexp( width, /^([0-9])+$/, "number field only allow : 0-9" );
                    valid = valid && checkRegexp( height, /^([0-9])+$/, "number field only allow : 0-9" );

                    wval = width.val();
                    hval = height.val();
            
                    if ( valid ) {
                        prepareCanvas(wval, hval);
                        dialog.dialog( "close" );
                    } else {
                        prepareCanvas(400,400);
                    }
                    return valid;
                }
            
                dialog = $( "#dialog-form" ).dialog({
                autoOpen: false,
                height: 400,
                width: 350,
                modal: true,
                buttons: {
                    "Set params": checkAndSet,
                    Cancel: function() {
                        dialog.dialog( "close" );
                    }
                },
                close: function() {
                    form[ 0 ].reset();
                    allFields.removeClass( "ui-state-error" );
                }
                });
            
                form = dialog.find( "form" ).on( "submit", function( event ) {
                    event.preventDefault();
                    checkAndSet();
                });

                dialog.dialog( "open" );
            
            } );
        </script>
    </body>
</html>